machine:
  java:
    version: oraclejdk8
  php:
    version: 7.0.4
dependencies:
  cache_directories:
    - /home/ubuntu/.phantomjs/2.1.1/x86_64-linux/bin
  pre:
    - sh install-phantomjs-2.1.1.sh
    - sudo apt-get install ant xvfb parallel openconnect
    - sudo apt-get update && sudo apt-get install --only-upgrade google-chrome-stable
    - sudo apt-get install unzip
    - wget -O /tmp/chromedriver.zip http://chromedriver.storage.googleapis.com/2.25/chromedriver_linux64.zip
    - echo "y" | sudo unzip /tmp/chromedriver.zip chromedriver -d /usr/local/bin/
    - sudo chmod 755 /usr/local/bin/chromedriver
    - wget https://sourceforge.net/projects/ubuntuzilla/files/mozilla/apt/pool/main/f/firefox-mozilla-build/firefox-mozilla-build_46.0.1-0ubuntu1_amd64.deb
    - sudo dpkg -i firefox-mozilla-build_46.0.1-0ubuntu1_amd64.deb
    - rm /opt/circleci/php/$(phpenv global)/etc/conf.d/xdebug.ini
  post:
    - wget https://selenium-release.storage.googleapis.com/2.53/selenium-server-standalone-2.53.1.jar

test:
  pre:
    - echo 'aeM[ohshib8W' | sudo openconnect vpn1.wingo.ch/wingo --user=aleksandr.balakiriev --passwd-on-stdin:
        background: true
    - phantomjs --webdriver=4445 --ignore-ssl-errors=true:
        background: true
    - java -jar selenium-server-standalone-2.53.1.jar:
         background: true
  override:
    - bin/behat -p chrome -f pretty -f progress
    - ant chrome_iphone_5 chrome_iphone_6_plus firefox
    - bin/behat -p phantomjs -f pretty -f progress:
        parallel: true

general:
  artifacts:
    - screenshots
    - report